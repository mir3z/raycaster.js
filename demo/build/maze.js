!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="/build/",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var i=n(2),o=r(i),a=n(17),u=r(a),c=n(15),l=r(c),f=n(20),s=r(f),h=document.querySelector("#screen"),d=new o.default(h),y=(0,u.default)(window).init(),v=new l.default;(0,s.default)(d,v,y)},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=e.CIRCLE=360,r=e.CIRCLE_1_2=n/2,i=e.CIRCLE_1_4=n/4,o=(e.CIRCLE_3_4=3*i,e.BLOCK_SIZE=64,e.normDeg=function(t){var e=t%n;return e<0?e+n:e},e.trunc=function(t){return Math.floor(t)},e.rad=function(t){return t*Math.PI/r+.001});e.sin=function(t){return Math.sin(o(t))},e.cos=function(t){return Math.cos(o(t))},e.tan=function(t){return Math.tan(o(t))}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){n(this,t),this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.ctx.msImageSmoothingEnabled=!1,this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}return r(t,[{key:"viewport",value:function(){var t=this.canvas,e=t.width,n=t.height;return{width:e,height:n}}},{key:"color",value:function(t){this.ctx.fillStyle=t}},{key:"text",value:function(t){var e=this,n=t.x,r=t.y,i=t.text,o=t.font;this.perform(function(){e.ctx.font=o,e.ctx.fillText(i,n,r)})}},{key:"rect",value:function(t){var e=t.x,n=t.y,r=t.width,i=t.height;this.ctx.fillRect(e,n,r,i)}},{key:"alpha",value:function(t){this.ctx.globalAlpha=t}},{key:"drawImage",value:function(t,e,n){this.ctx.drawImage(t,e.x,e.y,e.width,e.height,n.x,n.y,n.width,n.height)}},{key:"createBuffer",value:function(){var t=this.ctx.createImageData(this.canvas.width,this.canvas.height);return new o(t)}},{key:"flushBuffer",value:function(t){this.ctx.drawImage(t.flush(),0,0)}},{key:"createLayer",value:function(){return new t(a(this.canvas))}},{key:"composeLayer",value:function(t,e,n){e&&n?this.ctx.drawImage(t.canvas,e.x,e.y,e.width,e.height,n.x,n.y,n.width,n.height):e?this.ctx.drawImage(t.canvas,e.x,e.y,e.width,e.height):this.ctx.drawImage(t.canvas,0,0)}},{key:"perform",value:function(t){this.ctx.save(),t(this),this.ctx.restore()}},{key:"clear",value:function(){var t=this;this.perform(function(){t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height)})}}]),t}(),o=function(){function t(e){n(this,t),this.imageData=e;var r=this.imageData.data.buffer;this.buffer8=new Uint8ClampedArray(r,0,r.byteLength),this.buffer32=new Uint32Array(r)}return r(t,[{key:"putPixel",value:function(t,e){var n=t.x,r=t.y,i=e.r,o=e.g,a=e.b,u=e.a;this.buffer32[r*this.imageData.width+n]=u<<24|a<<16|o<<8|i}},{key:"flush",value:function(){this.imageData.data.set(this.buffer8);var t=a(this.imageData);return t.getContext("2d").putImageData(this.imageData,0,0),t}}]),t}(),a=e.createCanvas=function(t){var e=t.width,n=t.height,r=document.createElement("canvas");return r.width=e,r.height=n,r};e.readImageData=function(t){var e=a(t),n=e.getContext("2d");return n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height)};e.default=i},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t){var e=t.replace(/[^0-9A-F]/gi,"");return 3===e.length&&(e=e.split("").map(function(t){return t+t}).join("")),parseInt(e,16)}function i(t){return{r:t>>16&255,g:t>>8&255,b:255&t}}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255;n(this,t),this.r=e,this.g=r,this.b=i,this.a=o}return o(t,[{key:"multiply",value:function(e){return new t(this.r*e,this.g*e,this.b*e)}},{key:"toString",value:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a}}],[{key:"fromRGB",value:function(e){var n=e.r,r=e.g,i=e.b,o=e.a;return new t(n,r,i,o)}},{key:"fromHex",value:function(e){return t.fromRGB(i(r(e)))}}]),t}();e.default=a},function(t,e,n){"use strict";function r(t){var e=function(e){for(var n=e.x0,r=e.y0,o=e.dx,a=e.dy,u=e.limit,c=void 0===u?20:u,l=0;l<c;++l){var f=n+l*o,s=r+l*a,h=(0,i.trunc)(f/i.BLOCK_SIZE),d=(0,i.trunc)(s/i.BLOCK_SIZE);if(t(h,d))return{x:f,y:s}}return{x:Number.MAX_VALUE,y:Number.MAX_VALUE}};return function(t){var n=t.x,r=t.y,c=t.angle,l=(0,i.normDeg)(c),f=o(n,r,l,i.BLOCK_SIZE),s=a(n,r,l,i.BLOCK_SIZE),h=[];if(f){var d=e(f);d.vertical=!0,d.horizontal=!1,h.push(d)}if(s){var y=e(s);y.vertical=!1,y.horizontal=!0,h.push(y)}for(var v={x:null,y:null,distance:Number.MAX_VALUE},g=0,p=h.length;g<p;++g){var w=h[g],b=u(n,w.x,l);b<v.distance&&(v=w,v.distance=b)}return v}}Object.defineProperty(e,"__esModule",{value:!0}),e.createRaycaster=r;var i=n(1),o=function(t,e,n,r){if(0===n||n===i.CIRCLE_1_2)return null;var o=n>0&&n<i.CIRCLE_1_2,a=(0,i.trunc)(e/r)*r+(o?-.001:r),u=t+(e-a)/(0,i.tan)(n),c=o?-r:r,l=-c/(0,i.tan)(n);return{x0:u,y0:a,dx:l,dy:c}},a=function(t,e,n,r){if(n===i.CIRCLE_1_4||n===i.CIRCLE_3_4)return null;var o=n<i.CIRCLE_1_4||n>i.CIRCLE_3_4,a=(0,i.trunc)(t/r)*r+(o?r:-.001),u=e+(t-a)*(0,i.tan)(n),c=o?r:-r,l=-c*(0,i.tan)(n);return{x0:a,y0:u,dx:c,dy:l}},u=function(t,e,n){return Math.abs((t-e)/(0,i.cos)(n))}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(1),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,i=void 0===n?640:n,a=e.height,u=void 0===a?480:a,c=e.fov,l=void 0===c?60:c;r(this,t),this.width=i,this.height=u,this.fov=l,this.center={x:this.width/2,y:this.height/2},this.floorFactor=this.width/this.height*(0,o.cos)(this.fov/2)-.01,this.length=this.center.x/(0,o.tan)(this.fov/2),this.delta=this.fov/this.width,this.x=0,this.y=0,this.direction=0}return i(t,[{key:"setOrientation",value:function(t){var e=t.x,n=t.y,r=t.direction;this.x=e*o.BLOCK_SIZE,this.y=n*o.BLOCK_SIZE,this.direction=r}},{key:"viewport",value:function(){var t=this.width,e=this.height;return{width:t,height:e}}},{key:"render",value:function(t,e){var n=this.viewport(),r=e.getWall(),i=e.getFloor(),o=e.getSky();this.renderSky(o);for(var a=0;a<this.width;a+=1){var u=this.wallProjection(t,a);this.renderWall(u,r,e,a),this.renderFloor(u,i,e,a)}o.flush(n),r.flush(n),i.flush()}},{key:"renderWall",value:function(t,e,n,r){e.setRenderingStrategy(n.reconcileWall(t)).render(r,t)}},{key:"renderFloor",value:function(t,e,n,r){for(var i=t.wall.top+t.wall.height,o=t.viewport.height-i,a=i+o,u=i;u<a;u+=1){var c=this.floorProjection(t,u);e.setRenderingStrategy(n.reconcileFloor(c)).render(r,u,c)}}},{key:"renderSky",value:function(t){t.render({direction:this.direction,viewport:this.viewport()})}},{key:"wallProjection",value:function(t,e){var n=e*this.delta-.5*this.fov,r=this.direction-n,i=(0,o.cos)(n),a=t({x:this.x,y:this.y,angle:r}),u=a.distance*i,c=o.BLOCK_SIZE*this.length/u,l=this.center.y-c/2;return{from:{x:this.x,y:this.y,angle:this.direction},viewport:{width:this.width,height:this.height},wall:{x:a.x/o.BLOCK_SIZE,y:a.y/o.BLOCK_SIZE,horizontal:a.horizontal,vertical:a.vertical,top:l,height:c,distance:u}}}},{key:"floorProjection",value:function(t,e){var n=t.wall,r=t.from,i=n.top+n.height,a=this.height-i,u=i+a,c=r,l=u/(2*e-u),f=this.floorFactor*l/n.distance,s=c.x/o.BLOCK_SIZE+f*(n.x*o.BLOCK_SIZE-c.x),h=c.y/o.BLOCK_SIZE+f*(n.y*o.BLOCK_SIZE-c.y);return{floor:{x:s,y:h,distance:l}}}}]),t}();e.default=a},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){return t.multiply(e)}function c(t,e,n,r){return t.putPixel({x:e,y:n},r),t}Object.defineProperty(e,"__esModule",{value:!0}),e.TexturedFloorRenderingStrategy=e.SolidFloorRenderingStrategy=e.FloorRenderingStrategy=e.Floor=void 0;var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),f=n(3),s=r(f),h=(e.Floor=function(){function t(e,n){a(this,t),this.renderer=e,this.renderingStrategy=n,this.buffer=this.renderer.createBuffer()}return l(t,[{key:"setRenderingStrategy",value:function(t){return this.renderingStrategy=t,this}},{key:"render",value:function(t,e,n){return this.renderingStrategy.render(this.buffer,t,e,n),this}},{key:"flush",value:function(){this.renderer.flushBuffer(this.buffer),this.buffer=this.renderer.createBuffer()}}]),t}(),e.FloorRenderingStrategy=function(){function t(){a(this,t)}return l(t,[{key:"render",value:function(t,e,n,r){}}]),t}());e.SolidFloorRenderingStrategy=function(t){function e(t,n){a(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.color=t,r.shader=n,r}return o(e,t),l(e,[{key:"render",value:function(t,e,n,r){var i=this.shader(r);c(t,e,~~n,u(this.color,i))}}]),e}(h),e.TexturedFloorRenderingStrategy=function(t){function e(t,n){a(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.texture=t,r.shader=n,r}return o(e,t),l(e,[{key:"render",value:function(t,e,n,r){var i=r.floor,o=i.x,a=i.y,l=o*this.texture.width%this.texture.width,f=a*this.texture.height%this.texture.height,h=s.default.fromRGB(this.texture.at(~~l,~~f)),d=this.shader(r);c(t,e,~~n,u(h,d))}}]),e}(h)},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){n(this,t),this.running=!1,this.raf=e}return r(t,[{key:"start",value:function(){this.running=!0,this.raf.request()}},{key:"stop",value:function(){this.running=!1,this.raf.cancel()}},{key:"loop",value:function(t){var e=this;this.stop();var n=0,r=function(r){if(e.running){var i=r-n;t(i,r),n=r,e.raf.request()}};this.raf.register(r)}}]),t}();e.default=i},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e,r,i){n(this,t),this.map=e,this.renderer=r,this.assetStore=i,this.materials={},this.wall=null,this.floor=null,this.sky=null,this.setup(this.assetStore,this.renderer)}return r(t,[{key:"setup",value:function(){}},{key:"setWall",value:function(t){this.wall=t}},{key:"setFloor",value:function(t){this.floor=t}},{key:"setSky",value:function(t){this.sky=t}},{key:"getSky",value:function(){return this.sky}},{key:"getWall",value:function(){return this.wall}},{key:"getFloor",value:function(){return this.floor}},{key:"registerMaterial",value:function(t,e){this.materials[t]=e}},{key:"getMaterial",value:function(t){return this.materials[t]}},{key:"reconcileWall",value:function(){}},{key:"reconcileFloor",value:function(){}}]),t}();e.default=i},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(1),a=function(){function t(e){var n=e.width,i=e.height;r(this,t),this.width=n,this.height=i,this.grid=new Uint8Array(this.width*this.height)}return i(t,[{key:"at",value:function(t,e){return this.grid[(0,o.trunc)(t)+this.width*(0,o.trunc)(e)]}}],[{key:"fromGrid",value:function(e,n,r){if(e*n!==r.length)throw"Invalid map";var i=new t({width:e,height:n});return i.grid=Uint8Array.from(r),i}}]),t}();e.default=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return{dx:(0,a.cos)(t)*e,dy:(0,a.sin)(t)*e}}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(1),u=3,c=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.x,o=void 0===i?0:i,a=n.y,u=void 0===a?0:a,c=n.direction,l=void 0===c?0:c,f=arguments[1];r(this,t),this.x=o,this.y=u,this.direction=l,this.collides=function(t,n){return f(e.x+t,e.y+n)}}return o(t,[{key:"moveForward",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=i(this.direction,t),n=e.dx,r=e.dy;this.move(n,-r)}},{key:"moveBackward",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=i(this.direction,t),n=e.dx,r=e.dy;this.move(-n,r)}},{key:"move",value:function(t,e){this.collides(t*u,0)||(this.x+=t),this.collides(0,e*u)||(this.y+=e)}},{key:"rotateLeft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.rotate(t)}},{key:"rotateRight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.rotate(-t)}},{key:"rotate",value:function(t){this.direction=(this.direction+t)%a.CIRCLE}},{key:"position",get:function(){var t=this.x,e=this.y,n=this.direction;return{x:t,y:e,direction:n}}}]),t}();e.default=c},function(t,e,n){"use strict";function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.TexturedSkyRenderingStrategy=e.SolidSkyRenderingStrategy=e.SkyRenderingStrategy=e.Sky=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(1),c=(e.Sky=function(){function t(e,n){o(this,t),this.renderer=e,this.renderingStrategy=n,this.layer=this.renderer.createLayer()}return a(t,[{key:"setRenderingStrategy",value:function(t){return this.renderingStrategy=t,this}},{key:"render",value:function(t){var e=t.viewport;return this.viewport=e,this.renderingStrategy.render(this.layer,t),this}},{key:"flush",value:function(t){var e=t.width,n=t.height,r={x:0,y:0,width:e,height:n};this.renderer.composeLayer(this.layer,r,r),this.layer.clear()}}]),t}(),e.SkyRenderingStrategy=function(){function t(){o(this,t)}return a(t,[{key:"render",value:function(t,e){}}]),t}());e.SolidSkyRenderingStrategy=function(t){function e(t){o(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.color=t,n}return i(e,t),a(e,[{key:"render",value:function(t,e){var n=e.viewport,r=n.width,i=n.height;t.color(this.color),t.rect({x:0,y:0,width:r,height:i})}}]),e}(c),e.TexturedSkyRenderingStrategy=function(t){function e(t){o(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.texture=t,n}return i(e,t),a(e,[{key:"drawTextureTo",value:function(t,e){t.drawImage(this.texture.image,{x:0,y:0,width:this.texture.width,height:this.texture.height},e)}},{key:"render",value:function(t,e){var n=e.direction,r=e.viewport,i=r.height/this.texture.height,o=this.texture.width*i,a=this.texture.height*i,c=o*n/u.CIRCLE;this.drawTextureTo(t,{x:c,y:0,width:o,height:a}),c>0&&this.drawTextureTo(t,{x:c-o,y:0,width:o,height:a}),c+r.width<o&&this.drawTextureTo(t,{x:c+o,y:0,width:o,height:a})}}]),e}(c)},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(2),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,i=e.height,o=e.path;r(this,t),this.width=n,this.height=i,this.path=o,this.image=new Image,this.imageData=null}return i(t,[{key:"load",value:function(){var t=this,e=function(e,n){t.image.onload=function(){return e(t)},t.image.onerror=function(t){return n(t)},t.image.crossOrigin="Anonymous",t.image.src=t.path},n=function(t){return t.imageData=(0,o.readImageData)(t.image),t.data32=new Uint32Array(t.imageData.data.buffer),t};return new Promise(e).then(n)}},{key:"at",value:function(t,e){var n=this.data32[e*this.imageData.width+t];return{r:n>>0&255,g:n>>8&255,b:n>>16&255,a:n>>24&255}}}],[{key:"load",value:function(e){var n=new t({path:e});return n.load().then(function(t){return t.width=t.image.naturalWidth,t.height=t.image.naturalHeight,t})}}]),t}();e.default=a},function(t,e,n){"use strict";function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.SolidWallRenderingStrategy=e.TexturedWallRenderingStrategy=e.WallRenderingStrategy=e.Wall=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(1),c=(e.Wall=function(){function t(e,n){o(this,t),this.renderer=e,this.renderingStrategy=n,this.layer=this.renderer.createLayer()}return a(t,[{key:"setRenderingStrategy",value:function(t){return this.renderingStrategy=t,this}},{key:"render",value:function(t,e){return this.renderingStrategy.render(this.layer,t,e),this}},{key:"flush",value:function(t){var e=t.width,n=t.height,r={x:0,y:0,width:e,height:n};this.renderer.composeLayer(this.layer,r,r),this.layer.clear()}}]),t}(),e.WallRenderingStrategy=function(){function t(e){o(this,t),this.shader=e}return a(t,[{key:"render",value:function(t,e,n){}}]),t}());e.TexturedWallRenderingStrategy=function(t){function e(t,n){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return i.texture=t,i}return i(e,t),a(e,[{key:"render",value:function(t,e,n){var r=this,i=n.wall,o=i.horizontal?i.y*u.BLOCK_SIZE%u.BLOCK_SIZE:i.x*u.BLOCK_SIZE%u.BLOCK_SIZE,a=1,c=this.texture.width/u.BLOCK_SIZE*o;c=Math.min(c,this.texture.width-a),c=Math.max(c-a,0),t.drawImage(this.texture.image,{x:c,y:0,width:a,height:this.texture.height},{x:e,y:i.top,width:a,height:i.height}),t.perform(function(t){t.color("#000"),t.alpha(1-r.shader({projection:n})),t.rect({x:e,y:i.top-.5,width:a,height:i.height+.5})})}}]),e}(c),e.SolidWallRenderingStrategy=function(t){function e(t,n){o(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return i.color=t,i}return i(e,t),a(e,[{key:"render",value:function(t,e,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=n.wall;t.perform(function(t){t.color(r.color),t.rect({x:e,y:o.top,width:i,height:o.height})}),t.perform(function(t){t.color("#000"),t.alpha(1-r.shader({projection:n})),t.rect({x:e,y:o.top-.5,width:i,height:o.height+.5})})}}]),e}(c)},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){n(this,t),this.renderer=e,this.layer=this.renderer.createLayer(),this.fps=null}return r(t,[{key:"update",value:function(t){this.fps=t}},{key:"toString",value:function(){return(this.fps||0).toFixed(1)+" FPS"}},{key:"render",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.color,r=void 0===n?"white":n,i=e.font,o=void 0===i?"14px monospace":i,a=e.x,u=void 0===a?5:a,c=e.y,l=void 0===c?15:c;this.fps&&(this.layer.perform(function(e){e.clear(),e.color(r),e.text({x:u,y:l,text:t.toString(),font:o})}),this.renderer.composeLayer(this.layer))}}]),t}();e.default=i},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){n(this,t),this.register(e)}return r(t,[{key:"register",value:function(t){this.frame=t}},{key:"request",value:function(){this.frame&&window.requestAnimationFrame(this.frame)}},{key:"cancel",value:function(){this.frame&&window.cancelAnimationFrame(this.frame)}}]),t}();e.default=i},function(t,e){"use strict";function n(){var t={};return{load:function e(n){var r=function(e){return function(n){return t[e]=n}},e=function(t){var e=t.key,n=t.loader;return n().then(r(e))};return Promise.all(n.map(e))},provide:function(e){var n=t[e];if(!n)throw'No asset known as "'+e+'"';return n}}}Object.defineProperty(e,"__esModule",{value:!0}),e.createAssetStore=n},function(t,e){"use strict";function n(t){var e={},n={},c=function(t){return function(r){var i=r.keyCode;i in e&&(r.preventDefault(),r.stopPropagation(),n[i]=t)}},l=function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return function(t){if(n[t]){var i;(i=e[t]).notify.apply(i,r)}}};return{init:function(){return t.addEventListener("keydown",c(!0),!1),t.addEventListener("keyup",c(!1),!1),this},notify:function t(){var t=l.apply(void 0,arguments);Object.keys(n).forEach(t)},register:function(t,n){return e[t]=e[t]||r(),e[t].register(n),this},onKeyLeft:function(t){return this.register(i,t)},onKeyRight:function(t){return this.register(o,t)},onKeyUp:function(t){return this.register(a,t)},onKeyDown:function(t){return this.register(u,t)}}}function r(){var t=[];return{register:function(e){t.push(e)},notify:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];t.forEach(function(t){return t.apply(void 0,n)})}}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n;var i=37,o=39,a=38,u=40},function(t,e){"use strict";function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,e=0;return{update:function(n){e+=(n-e)/t},get fps(){return 1e3/e}}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(13),l=n(6),f=n(11),s=n(8),h=r(s),d=function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),u(e,[{key:"setup",value:function(t,e){var n=function(t){var e=t.projection,n=e.wall.horizontal?1:.6;return Math.min(1/e.wall.distance*70,1)*n},r=function(t){var e=t.floor.distance;return 1/e*.7};this.stoneWall=new c.TexturedWallRenderingStrategy(t.provide("STONE"),n),this.grassFloor=new l.TexturedFloorRenderingStrategy(t.provide("GRASS"),r),this.setSky(new f.Sky(e,new f.TexturedSkyRenderingStrategy(t.provide("SKY")))),this.setWall(new c.Wall(e)),this.setFloor(new l.Floor(e))}},{key:"reconcileWall",value:function(t){var e=t.wall;e.x,e.y;return this.stoneWall}},{key:"reconcileFloor",value:function(t){var e=t.floor;e.x,e.y;return this.grassFloor}}]),e}(h.default);e.default=d},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e,n){function r(){var e=function(t){return function(e,n){return t.at(e,n)>0}},r=c.default.fromGrid(20,20,S.default),a=e(r),l=new _.default(r,t,u),s=new f.default({x:1.5,y:18.5,direction:90},a),d=(0,o.createRaycaster)(a),y=(0,w.default)(),v=new m.default(t),g=new h.default({width:400,height:250});return setInterval(function(){return v.update(y.fps)},500),i(s),function(e){n.notify(e),g.setOrientation(s.position),t.clear(),g.render(d,l),y.update(e),v.render()}}function i(t){var e=function(t,e){return function(n){return e(t*n/1e3)}};n.onKeyLeft(e(150,function(e){return t.rotateLeft(e)})).onKeyRight(e(150,function(e){return t.rotateRight(e)})).onKeyUp(e(4,function(e){return t.moveForward(e)})).onKeyDown(e(4,function(e){return t.moveBackward(e)}))}var u=(0,a.createAssetStore)(),l=function(t){return function(){return g.default.load("../assets/"+t)}},s=[{key:"GRASS",loader:l("grass.jpg")},{key:"STONE",loader:l("stone.jpg")},{key:"SKY",loader:l("red-sky.jpg")}];u.load(s).then(function(){var t=new y.default(e);t.loop(r()),t.start()})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var o=n(4),a=n(16),u=n(9),c=r(u),l=n(10),f=r(l),s=n(5),h=r(s),d=n(7),y=r(d),v=n(12),g=r(v),p=n(18),w=r(p),b=n(14),m=r(b),x=n(19),_=r(x),k=n(21),S=r(k)},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,0,1,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,0,1,0,1,0,1,1,1,1,0,1,0,1,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,1,1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,1,0,0,0,1,1,0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,0,1,0,1,1,0,1,0,1,0,1,0,1,0,1,1,1,1,1,1,0,1,0,1,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1,0,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,0,0,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,1,1,0,1,0,1,1,0,0,0,1,1,1,1,1,1,1,1,0,0,1,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,0,1,0,0,1,1,0,0,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,0,1,1,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}]);